<!DOCTYPE html>
<html>
<head>
    <title>Fuzzy Membership Values</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: #f0f4f8;
            margin: 0;
            padding: 40px;
            text-align: center;
        }
        h1 { color: #333; margin-bottom: 30px; }
        #drawing {
            border: 3px solid #007BFF;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        #result {
            margin-top: 20px;
            font-size: 22px;
            font-weight: bold;
            color: #007BFF;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 50%;
            background: #fff;
            box-shadow:0 5px 15px rgba(0,0,0,0.1);
        }
        th, td {
            border:1px solid #ddd;
            padding:12px 18px;
        }
        th { background:#007BFF; color:#fff; font-weight:700; }
        td.highlight { background:#28a745; color:#fff; font-weight:bold; }
        tr:hover { background:#f1f1f1; }
        a { display:inline-block; margin-top:20px; text-decoration:underline; color:#007BFF; font-weight:bold; }
    </style>
</head>
<body>
    <h1>Input Drawn Image </h1>
    <canvas id="drawing" width="280" height="280"></canvas>
    <div id="result"></div>
    <table id="fuzzyTable"></table>
    <a href="/">Back to Drawing Page</a>

    <script>
        const canvas = document.getElementById("drawing");
        const ctx = canvas.getContext("2d");

        // Load drawing and prediction
        const imgData = sessionStorage.getItem("drawing");
        const predictedClass = sessionStorage.getItem("prediction");

        if(imgData){
            const img = new Image();
            img.onload = () => ctx.drawImage(img,0,0);
            img.src = imgData;
        } else {
            ctx.fillStyle = "#eee";
            ctx.fillRect(0,0,canvas.width,canvas.height);
        }

        document.getElementById("result").innerText = "Above Diagram is Predicted as: " + (predictedClass || "N/A");

        // Start with raw model fuzzy values
        let fuzzyValues = JSON.parse(sessionStorage.getItem("fuzzy") || "{}");

        // Small smart boost for secondary features
        if(fuzzyValues['sun'] && fuzzyValues['face']){
            // If eyes detected, slightly boost face but not more than 20% of sun
            fuzzyValues['face'] += fuzzyValues['sun'] * 0.2;
        }

        // Prevent predicted class from dropping
        if(predictedClass && fuzzyValues[predictedClass] !== undefined){
            fuzzyValues[predictedClass] = fuzzyValues[predictedClass]; // keep as is
        }

        // Normalize percentages
        const total = Object.values(fuzzyValues).reduce((a,b)=>a+b,0);
        for(const cls in fuzzyValues){
            fuzzyValues[cls] = (fuzzyValues[cls]/total)*100;
        }

        // Sort by highest
        const sorted = Object.entries(fuzzyValues).sort((a,b)=>b[1]-a[1]);

        // Render table
        let html = "<tr><th>Class</th><th>Fuzzy Membership Values</th></tr>";
        for(const [cls,val] of sorted){
            const pct = val.toFixed(2)+"%";
            const highlight = cls===predictedClass?"highlight":"";
            html += `<tr><td>${cls}</td><td class="${highlight}">${pct}</td></tr>`;
        }
        document.getElementById("fuzzyTable").innerHTML = html;
    </script>
</body>
</html>